## mappings of the different turns to [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53]
mappings = {'F': [0, 1, 2, 3, 4, 5, 17, 14, 11, 9, 10, 45, 12, 13, 46, 15, 16, 47, 24, 21, 18, 25, 22, 19, 26, 23, 20, 6, 28, 29, 7, 31, 32, 8, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 33, 30, 27, 48, 49, 50, 51, 52, 53], "F'": [0, 1, 2, 3, 4, 5, 27, 30, 33, 9, 10, 8, 12, 13, 7, 15, 16, 6, 20, 23, 26, 19, 22, 25, 18, 21, 24, 47, 28, 29, 46, 31, 32, 45, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 11, 14, 17, 48, 49, 50, 51, 52, 53], 'L': [44, 1, 2, 41, 4, 5, 38, 7, 8, 15, 12, 9, 16, 13, 10, 17, 14, 11, 0, 19, 20, 3, 22, 23, 6, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 51, 39, 40, 48, 42, 43, 45, 18, 46, 47, 21, 49, 50, 24, 52, 53], "L'": [18, 1, 2, 21, 4, 5, 24, 7, 8, 11, 14, 17, 10, 13, 16, 9, 12, 15, 45, 19, 20, 48, 22, 23, 51, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 6, 39, 40, 3, 42, 43, 0, 44, 46, 47, 41, 49, 50, 38, 52, 53], 'R': [0, 1, 20, 3, 4, 23, 6, 7, 26, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 47, 21, 22, 50, 24, 25, 53, 33, 30, 27, 34, 31, 28, 35, 32, 29, 8, 37, 38, 5, 40, 41, 2, 43, 44, 45, 46, 42, 48, 49, 39, 51, 52, 36], "R'": [0, 1, 42, 3, 4, 39, 6, 7, 36, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 2, 21, 22, 5, 24, 25, 8, 29, 32, 35, 28, 31, 34, 27, 30, 33, 53, 37, 38, 50, 40, 41, 47, 43, 44, 45, 46, 20, 48, 49, 23, 51, 52, 26], 'B': [29, 32, 35, 3, 4, 5, 6, 7, 8, 2, 10, 11, 1, 13, 14, 0, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 53, 30, 31, 52, 33, 34, 51, 42, 39, 36, 43, 40, 37, 44, 41, 38, 45, 46, 47, 48, 49, 50, 9, 12, 15], "B'": [15, 12, 9, 3, 4, 5, 6, 7, 8, 51, 10, 11, 52, 13, 14, 53, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 0, 30, 31, 1, 33, 34, 2, 38, 41, 44, 37, 40, 43, 36, 39, 42, 45, 46, 47, 48, 49, 50, 35, 32, 29], 'D': [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 42, 43, 44, 18, 19, 20, 21, 22, 23, 15, 16, 17, 27, 28, 29, 30, 31, 32, 24, 25, 26, 36, 37, 38, 39, 40, 41, 33, 34, 35, 51, 48, 45, 52, 49, 46, 53, 50, 47], "D'": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 24, 25, 26, 18, 19, 20, 21, 22, 23, 33, 34, 35, 27, 28, 29, 30, 31, 32, 42, 43, 44, 36, 37, 38, 39, 40, 41, 15, 16, 17, 47, 50, 53, 46, 49, 52, 45, 48, 51], 'U': [6, 3, 0, 7, 4, 1, 8, 5, 2, 18, 19, 20, 12, 13, 14, 15, 16, 17, 27, 28, 29, 21, 22, 23, 24, 25, 26, 36, 37, 38, 30, 31, 32, 33, 34, 35, 9, 10, 11, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53], "U'": [2, 5, 8, 1, 4, 7, 0, 3, 6, 36, 37, 38, 12, 13, 14, 15, 16, 17, 9, 10, 11, 21, 22, 23, 24, 25, 26, 18, 19, 20, 30, 31, 32, 33, 34, 35, 27, 28, 29, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53]}

# these functions perform operations on the masks not the cube
# this is because it is more efficient to manipulate the mask directly than the cube
# especially during the recursive BFS
def rotate(mask: str, rotation: str) -> str:
    """Rotates a mask given a specific rotation.
    
    Args:
        mask (str): The mask to rotate.
        rotation (str): The rotation to perform.

    Returns:
        str: The rotated mask.
    """
    output = [' '] * 54
    mapping = mappings[rotation]
    for i in range(54):
        output[i] = mask[mapping[i]]
    return "".join(output)

def checkMask(mask: str, state: str) -> bool:
    """Checks if a mask and a state match.

    Args:
        mask (str): The mask to check.
        state (str): The state to check against.

    Returns:
        bool: True if the mask matches the state, False otherwise.
    """
    for i in range(len(mask)):
        if mask[i] != '.' and mask[i] != state[i]:
            return False
    return True


def optimiseMoves(moves: list[str]) -> list[str]:
    """
    Looks through a list of moves and applies general rules to reduce the 
    total number of rotations while maintaining the same output. i.e. running
    this function will result in a shorter list of moves that will perform
    the same transformation on the cube.       

    Args:
        moves (list[str]): The list of moves to optimise. 

    Returns:
        list[str]: The optimised list of moves.
    """
    ## checking if there is a repeated section of 4
    newList = []
    i = 0
    while i <= len(moves) - 4:
        if moves[i] == moves[i+1] == moves[i+2] == moves[i+3]:
            i += 4
        else:
            newList.append(moves[i])
            i += 1

    newList += moves[i:]

    ## replacing repeated sections of length 3 
    moves = newList.copy()
    newList = []
    i = 0
    while i <= len(moves) - 3:
        if moves[i] == moves[i+1] == moves[i+2]:
            if len(moves[i]) == 1:
                newList.append(moves[i] + 'i')
            else:
                newList.append(moves[i][0])
            i += 3
            
        else:
            newList.append(moves[i])
            i += 1

    newList += moves[i:]

    ## removing all occurences of a move followed by its inverse

    moves = newList.copy()
    newList = []
    i = 0
    skippedLast = False
    while i < len(moves) -1:
        if moves[i][0] == moves[i+1][0] and moves[i] != moves[i+1]:
            i += 2
            skippedLast = False
        else:
            newList.append(moves[i])
            i += 1
            skippedLast = True

    if skippedLast:
        newList.append(moves[-1])

    return newList

def printAnalysis(analysis: dict) -> None:
    """Prints the analysis of multiple solves to the console.

    Args:
        analysis (dict): The analysis dictionary containing the statistics.
    """

    print(f"\n-----------------------------")
    print(f"Average Solve Time: {analysis['avg_time']}")
    print(f"Avg number of Rotations: {round(analysis['avg_moves'], 5)}")
    print(f"Avg number of optimised rotations: {round(analysis['avg_moves_optimised'], 5)}")
    print(f"Avg number of rotations saved:  {round(analysis['avg_moves_saved'],2)}")

    print(f"-----------------------------")

    print(f"Avg Cross Time: {analysis['avg_cross_time']}")
    print(f"Avg Corners Time: {analysis['avg_corners_time']}")
    print(f"Avg Middles Time: {analysis['avg_middles_time']}")
    print(f"Avg Yellow Cross Time: {analysis['avg_yellow_cross_time']}")
    print(f"Avg Yellow Edges Time: {analysis['avg_yellow_edges_time']}")
    print(f"Avg Final Time: {analysis['avg_final_time']}")
    
    print(f"-----------------------------")

    print(f"Max Cross Time: {analysis['max_cross_time']}")
    print(f"Max Corners Time: {analysis['max_corners_time']}")
    print(f"Max Middles Time: {analysis['max_middles_time']}")
    print(f"Max Yellow Cross Time: {analysis['max_yellow_cross_time']}")
    print(f"Max Yellow Edges Time: {analysis['max_yellow_edges_time']}")
    print(f"Max Final Time: {analysis['max_final_time']}")
    print(f"-----------------------------")